<!DOCTYPE html>
<html lang="fr">
<head>
$(if refresh-timeout)
<meta http-equiv="refresh" content="$(refresh-timeout-secs)">
$(endif)
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0" />   
<meta http-equiv="pragma" content="no-cache">
<meta http-equiv="expires" content="-1">
<title>mnaSpot - Status</title>
<link rel="stylesheet" href="css/style.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body class="octalink-bg">
    <div class="octalink-flex">
        <div>
            <div class="octalink-card">
                <div class="octalink-card-header">
                    <span class="macos-dot red"></span>
                    <span class="macos-dot yellow"></span>
                    <span class="macos-dot green"></span>
                </div>
                <div class="octalink-logo" style="display: flex; align-items: center; justify-content: center; gap: 16px;">
                    <svg viewBox="0 0 24 24" class="wifi-icon" style="width:48px; height:48px;"><path d="M12,3L2,12H5V20H11V14H13V20H19V12H22L12,3M12,7.7C14.1,7.7 15.8,9.4 15.8,11.5C15.8,13.6 14.1,15.3 12,15.3C9.9,15.3 8.2,13.6 8.2,11.5C8.2,9.4 9.9,7.7 12,7.7Z" fill="#fff"/></svg>
                    <span class="brand-name" style="font-size:2rem; font-weight:700; color:#fff; letter-spacing:1px;">MnaSpot</span>
                </div>
                <h2 class="octalink-title">Statut de Connexion</h2>
                <p class="octalink-subtitle">Informations sur votre session WiFi</p>
                
                <div class="status-info-container">
                    <div class="status-info-item">
                        <span class="status-label">Utilisateur</span>
                        <span class="status-value">$(username)</span>
                    </div>
                    
                    <div class="status-info-item">
                        <span class="status-label">Adresse IP</span>
                        <span class="status-value">$(ip)</span>
                    </div>
                    
                    <div class="status-info-item">
                        <span class="status-label">Adresse MAC</span>
                        <span class="status-value">$(mac)</span>
                    </div>
                    
                    <div class="status-info-item">
                        <span class="status-label">Données utilisées</span>
                        <span class="status-value">$(bytes-in-nice) / $(bytes-out-nice)</span>
                    </div>
                    
                    $(if remain-bytes-total)
                    <div class="status-info-item">
                        <span class="status-label">Données restantes</span>
                        <span class="status-value">$(remain-bytes-total-nice)</span>
                    </div>
                    $(endif)
                    
                    $(if session-time-left)
                    <div class="status-info-item">
                        <span class="status-label">Temps connecté</span>
                        <span class="status-value"><span id="upt1">$(uptime)</span></span>
                    </div>
                    <div class="status-info-item">
                        <span class="status-label">Temps restant</span>
                        <span class="status-value"><span id="stl">$(session-time-left)</span></span>
                    </div>
                    $(else)
                    <div class="status-info-item">
                        <span class="status-label">Temps connecté</span>
                        <span class="status-value"><span id="upt2">$(uptime)</span></span>
                    </div>
                    $(endif)
                    
                    $(if blocked == 'yes')
                    <div class="status-info-item">
                        <span class="status-label">Statut</span>
                        <span class="status-value">
                            <a href="$(link-advert)" target="hotspot_advert" class="status-badge advert">Publicité requise</a>
                        </span>
                    </div>
                    $(elif refresh-timeout)
                    <div class="status-info-item">
                        <span class="status-label">Statut</span>
                        <span class="status-value">
                            <span class="status-badge connected">Connecté</span>
                        </span>
                    </div>
                    <div class="status-info-item">
                        <span class="status-label">Actualisation</span>
                        <span class="status-value">$(refresh-timeout)</span>
                    </div>
                    $(endif)
                </div>

                $(if login-by-mac != 'yes')
                <form action="$(link-logout)" name="logout" onSubmit="return openLogout()">
                    <button type="submit" class="octalink-btn-primary">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 8px; vertical-align: middle;">
                            <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
                        </svg>
                        Se déconnecter
                    </button>
                </form>
                $(endif)
            </div>
        </div>
    </div>
    
    <!-- Navbar dock style en bas -->
    <nav class="octalink-navbar">
        
        <a href="services.html" class="nav-item"><span class="nav-icon">&#x1F451;</span> Services</a>
        <a href="messagerie.html" class="nav-item"><span class="nav-icon">&#x1F464;</span> Contact</a>
    </nav>

<script src="conf.js"></script>
<script src="js/theme-toggle.js"></script>

<script>
$(if advert-pending == 'yes')
    var popup = '';
    function focusAdvert() {
	if (window.focus) popup.focus();
    }
    function openAdvert() {
	popup = open('$(link-advert)', 'hotspot_advert', '');
	setTimeout("focusAdvert()", 1000);
    }
$(endif)
    function openLogout() {
	if (window.name != 'hotspot_status') return true;
        open('$(link-logout)', 'hotspot_logout', 'toolbar=0,location=0,directories=0,status=0,menubars=0,resizable=1,width=280,height=250');
	window.close();
	return false;
    }

    // Time formatting function
    function timeNice(b) {
        var d = b.innerHTML;
        var f = d.search('w');
        var g = d.search('d');
        var h = d.search('h');
        var j = d.search('m');
        var k = d.search('s');
        
        if (f > 0) {
            var weak = 7 * Number(d.split('w')[0]);
            var t_day = d.substring(f + 1, d.length);
        } else if (f < 0) {
            var weak = '';
            var t_day = d.substring(0, d.length);
        }
        
        if (g > 0) {
            if (weak > 0) {
                var day = Number(t_day.split('d')[0]);
            } else {
                var day = t_day.split('d')[0];
            }
            var t_hour = d.substring(g + 1, d.length);
        } else if (g < 0) {
            var day = '';
            var t_hour = t_day.substring(0, t_day.length);
        }
        
        if (h > 0) {
            var hour = t_hour.split('h')[0];
            if (hour.length == 1) hour = '0' + hour + ':';
            else hour += ':';
            var t_minute = d.substring(h + 1, d.length);
        } else if (h < 0) {
            var hour = '';
            var t_minute = d.substring(g + 1, d.length);
        }
        
        if (j > 0) {
            var minute = t_minute.split('m')[0];
            if (minute.length == 1) minute = '0' + minute;
            var t_sec = d.substring(j + 1, d.length);
        } else if (j < 0 && h < 0) {
            var minute = '00';
            var t_sec = d.substring(g + 1, d.length);
        } else if (j < 0) {
            var minute = '00';
            var t_sec = d.substring(h + 1, d.length);
        }
        
        if (k > 0) {
            var sec = t_sec.split('s')[0];
            if (sec.length == 1) sec = ':0' + sec;
            else sec = ':' + sec;
        } else if (k < 0) {
            var sec = ':00';
        }
        
        var l = Number(weak) + Number(day);
        if (l < 1) l = '';
        else l += 'd ';
        
        b.innerHTML = l + hour + minute + sec;
    }

    // Apply time formatting to elements
    if (document.getElementById('upt1')) {
        timeNice(document.getElementById('upt1'));
    }
    if (document.getElementById('upt2')) {
        timeNice(document.getElementById('upt2'));
    }
    if (document.getElementById('stl')) {
        timeNice(document.getElementById('stl'));
    }
</script>

$(if advert-pending == 'yes')
<body onLoad="openAdvert()">
$(endif)
</body>
</html>
